# 7.2 Reservoir Sampling and Other Methods

While the goal of many sampling techniques is to obtain a perfectly representative subset of the data, there are situations where it is desirable to use a method that is either intentionally or unintentionally biased. This section explores reservoir sampling as a baseline for unbiased sampling and then discusses other methods that can introduce bias.

## Reservoir Sampling: Unbiased Random Sampling

Reservoir sampling is a family of randomized algorithms for selecting a simple random sample of *k* items from a population of unknown size, such as a data stream. The key advantage of reservoir sampling is that it allows for the selection of a random sample in a single pass over the data, using a fixed amount of memory.

*   **How it works (Algorithm R):**
    1.  The first *k* items of the stream are stored in a "reservoir."
    2.  For each subsequent item *i* in the stream, a random number *j* is generated between 1 and *i*.
    3.  If *j* is less than or equal to *k*, the *j*-th element in the reservoir is replaced with the *i*-th item from the stream.

In its standard form, reservoir sampling is designed to produce an **unbiased** simple random sample, where every item in the stream has an equal probability of being included in the final sample.

## Intentionally Biased Sampling Methods

In some cases, it is desirable to introduce bias to focus on particular aspects of the data. This is where intentionally biased sampling methods are used.

### Weighted Reservoir Sampling

Weighted reservoir sampling is a powerful technique for intentionally biasing a sample from a massive dataset or stream. In this method, each item is assigned a weight, and its probability of being included in the sample is proportional to its weight. This allows for the oversampling of certain subgroups that may be rare but are of high interest.

*   **How it works:** Instead of each item having an equal chance of being included in the reservoir, the selection probability is influenced by the item's weight. There are several algorithms for weighted reservoir sampling, such as Algorithm A-Chao, where an item's relative weight is used to decide if it should be added to the reservoir.

*   **Example: Oversampling for Fraud Detection:**
    Imagine a massive stream of user activity data from an e-commerce website. Let's say that 99% of the activities are "view item," while only 1% are "purchase." For a fraud detection analysis, the "purchase" events are much more important, but a simple random sample would be dominated by "view item" events.

    To address this, you can use weighted reservoir sampling to oversample the "purchase" events:

    1.  **Assign Weights:** Assign a higher weight to "purchase" events and a lower weight to "view item" events (e.g., `weight("purchase") = 100`, `weight("view item") = 1`).
    2.  **Apply Weighted Reservoir Sampling:** As the stream of user activities is processed, the weighted reservoir sampling algorithm will be more likely to select "purchase" events for inclusion in the reservoir due to their higher weight.

    The resulting sample will be intentionally biased towards "purchase" events, providing a richer dataset for training a fraud detection model than a simple random sample would have.

### Other Sampling Methods with Potential for Bias

While not always intentionally biased, other sampling methods can introduce bias if not used carefully:

*   **Systematic Sampling:** Selecting items at regular intervals. This can lead to a **periodicity bias** if the data has a recurring pattern that aligns with the sampling interval.
*   **Cluster Sampling:** The population is divided into clusters, and a random sample of entire clusters is selected. This can introduce a **non-representative cluster bias** if the chosen clusters are not representative of the overall population.
